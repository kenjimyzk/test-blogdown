<!DOCTYPE html>
<html lang="ja-jp">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.21" />


<title>journal2 - A Hugo website</title>
<meta property="og:title" content="journal2 - A Hugo website">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="../../../../css/fonts.css" media="all">
<link rel="stylesheet" href="../../../../css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="../../../../" class="nav-logo">
    <img src="../../../../images/sarah.jpg"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="https://github.com/rstudio/blogdown">GitHub</a></li>
    
    <li><a href="../../../../about/">Kenji Miyazaki</a></li>
    
    <li><a href="https://twitter.com/rstudio">Twitter</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">3 min read</span>
    

    <h1 class="article-title">journal2</h1>

    
    <span class="article-date">2017/09/06</span>
    

    <div class="article-content">
      <pre class="r"><code>library(knitr)
library(tidyverse)
library(mosaic)
library(AER)</code></pre>
<p>データを次のように整形</p>
<pre class="r"><code>data(&quot;Journals&quot;, package = &quot;AER&quot;)
journals &lt;- Journals %&gt;% 
  mutate(citeprice = price/citations,
         age = 2000 - foundingyear,
         chars = charpp*pages/10^7) %&gt;%
  select(subs,price,citeprice,age,chars)</code></pre>
<p>基本統計量は以下のとおりである.</p>
<pre class="r"><code>inspect(journals)</code></pre>
<pre><code>## 
## quantitative variables:  
##        name   class          min          Q1      median          Q3
## 1      subs integer  2.000000000  52.0000000 122.5000000 268.2500000
## 2     price integer 20.000000000 134.5000000 282.0000000 540.7500000
## 3 citeprice numeric  0.005222803   0.4644950   1.3205128   3.4401713
## 4       age numeric  4.000000000  17.7500000  27.0000000  37.2500000
## 5     chars numeric  0.055063800   0.1657681   0.2187661   0.3182933
##           max        mean          sd   n missing
## 1 1098.000000 196.8666667 204.5288468 180       0
## 2 2120.000000 417.7222222 385.8345964 180       0
## 3   24.459459   2.5484546   3.4664437 180       0
## 4  156.000000  33.0944444  25.7114841 180       0
## 5    1.012794   0.2672651   0.1600183 180       0</code></pre>
<p>対数表記して散布図を表示する.</p>
<pre class="r"><code>plot(subs ~ citeprice, data = log(journals), pch = 19)</code></pre>
<p><img src="../../../../post/2017-09-06-journal2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>単回帰式の結果である.</p>
<pre class="r"><code>fm1 &lt;- lm(subs ~ citeprice, data = log(journals))
summary(fm1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = subs ~ citeprice, data = log(journals))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.72478 -0.53609  0.03721  0.46619  1.84808 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.76621    0.05591   85.25   &lt;2e-16 ***
## citeprice   -0.53305    0.03561  -14.97   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7497 on 178 degrees of freedom
## Multiple R-squared:  0.5573, Adjusted R-squared:  0.5548 
## F-statistic:   224 on 1 and 178 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>回帰直線は次のようにして表示する.</p>
<pre class="r"><code>plot(subs ~ citeprice, data = log(journals), pch = 19)
abline(fm1)</code></pre>
<p><img src="../../../../post/2017-09-06-journal2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>パッケージ <code>ggformula</code> を使えば以下のコマンドを実施する.</p>
<pre class="r"><code>gf_point(subs ~ citeprice, data = log(journals)) %&gt;% gf_lm()</code></pre>
<p><img src="../../../../post/2017-09-06-journal2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p><code>gf_lm</code> でなく <code>gf_fun</code> を使うこともできる.</p>
<pre class="r"><code>fn1&lt;-makeFun(fm1)
gf_point(subs ~ citeprice, data = log(journals)) %&gt;% gf_fun(fn1)</code></pre>
<p><img src="../../../../post/2017-09-06-journal2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>多変量回帰モデルのときは <code>gf_fun</code> のほうが柔軟に対応できる. 結果は以下の通り.</p>
<pre class="r"><code>fm2 &lt;- update(fm1, .~ citeprice + age + chars)
summary(fm2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = subs ~ citeprice + age + chars, data = log(journals))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.51996 -0.41211  0.03173  0.44657  1.80588 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.68009    0.33289  11.055  &lt; 2e-16 ***
## citeprice   -0.40772    0.04196  -9.717  &lt; 2e-16 ***
## age          0.42365    0.08972   4.722 4.75e-06 ***
## chars        0.20561    0.10747   1.913   0.0573 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7047 on 176 degrees of freedom
## Multiple R-squared:  0.6132, Adjusted R-squared:  0.6066 
## F-statistic: 93.01 on 3 and 176 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>図の軸に表示しない変数は平均値として図示すると以下になる.</p>
<pre class="r"><code>fn2 &lt;- makeFun(fm2)
fn2m &lt;- makeFun(fn2(citeprice, age=mage, chars=mchars) ~ citeprice, 
                mage = with(log(journals), mean(age)),
                mchars = with(log(journals), mean(age)))
gf_point(subs ~ citeprice, data = log(journals)) %&gt;% 
  gf_fun(fn1) %&gt;% gf_fun(fn2m,color=&quot;red&quot;)</code></pre>
<p><img src="../../../../post/2017-09-06-journal2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>交差項は次のようにして組み込むことができる.</p>
<pre class="r"><code>fm3 &lt;- update(fm1, .~ citeprice * age + chars)
summary(fm3)</code></pre>
<pre><code>## 
## Call:
## lm(formula = subs ~ citeprice + age + chars + citeprice:age, 
##     data = log(journals))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.19007 -0.43541  0.05901  0.39276  1.75026 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    3.96189    0.33693  11.759  &lt; 2e-16 ***
## citeprice     -0.89891    0.16151  -5.566 9.66e-08 ***
## age            0.37351    0.08897   4.198 4.28e-05 ***
## chars          0.22947    0.10513   2.183  0.03038 *  
## citeprice:age  0.14096    0.04483   3.144  0.00196 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6876 on 175 degrees of freedom
## Multiple R-squared:  0.6339, Adjusted R-squared:  0.6255 
## F-statistic: 75.75 on 4 and 175 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>図の軸に表示しない変数は平均値として図示すると以下になる.</p>
<pre class="r"><code>fn3 &lt;- makeFun(fm3)
fn3m &lt;- makeFun(fn3(citeprice, age=mage, chars=mchars) ~ citeprice, 
                mage = with(log(journals), mean(age)),
                mchars = with(log(journals), mean(age)))
gf_point(subs ~ citeprice, data = log(journals)) %&gt;% 
  gf_fun(fn2m,color=&quot;red&quot;) %&gt;% gf_fun(fn3m,color=&quot;blue&quot;)</code></pre>
<p><img src="../../../../post/2017-09-06-journal2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>多項式は次のように組み込むことができる.</p>
<pre class="r"><code>fm4 &lt;- update(fm3, .~ . + I(citeprice^2) + I(citeprice^3))
summary(fm4)</code></pre>
<pre><code>## 
## Call:
## lm(formula = subs ~ citeprice + age + chars + I(citeprice^2) + 
##     I(citeprice^3) + citeprice:age, data = log(journals))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.25623 -0.41477  0.07605  0.40056  1.77711 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     3.947823   0.339917  11.614  &lt; 2e-16 ***
## citeprice      -0.960936   0.189220  -5.078 9.78e-07 ***
## age             0.373054   0.089361   4.175 4.72e-05 ***
## chars           0.234618   0.106133   2.211  0.02838 *  
## I(citeprice^2)  0.016510   0.024135   0.684  0.49484    
## I(citeprice^3)  0.003667   0.006862   0.534  0.59380    
## citeprice:age   0.155777   0.055050   2.830  0.00521 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6906 on 173 degrees of freedom
## Multiple R-squared:  0.6349, Adjusted R-squared:  0.6223 
## F-statistic: 50.15 on 6 and 173 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>図の軸に表示しない変数は平均値として図示すると以下になる.</p>
<pre class="r"><code>fn4 &lt;- makeFun(fm4)
fn4m &lt;- makeFun(fn4(citeprice, age=mage, chars=mchars) ~ citeprice, 
                mage = with(log(journals), mean(age)),
                mchars = with(log(journals), mean(age)))
gf_point(subs ~ citeprice, data = log(journals)) %&gt;% 
  gf_fun(fn3m,color=&quot;blue&quot;) %&gt;% gf_fun(fn4m,color=&quot;purple&quot;)</code></pre>
<p><img src="../../../../post/2017-09-06-journal2_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="../../../../index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="../../../../images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    

    
  </body>
</html>

